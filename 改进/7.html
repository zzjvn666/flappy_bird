<!DOCTYPE html>
      <html lang="zh-CN">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link rel="stylesheet" type="text/css" href="https://csdnimg.cn/release/blogv2/dist/pc/css/detail_enter-2fe393ff58.min.css">
        <link rel="stylesheet" type="text/css" href="https://csdnimg.cn/public/sandalstrap/1.4/css/sandalstrap.min.css">
        <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/kdoc_html_views-1a98987dfd.css">
        <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/ck_htmledit_views-704d5b9767.css">
        <style>
          body {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
          }
          img {
            max-width: 100%;
            height: auto;
          }
          pre {
            background-color: #e4dfdf;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
          }
          code {
            font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
          }
          blockquote {
            background: #f9f9f9;
            border-left: 10px solid #ccc;
            margin: 1.5em 10px;
            padding: 0.5em 10px;
          }
          table {
            border-collapse: collapse;
            width: 100%;
          }
          th, td {
            border: 1px solid #ddd;
            padding: 8px;
          }
          th {
            background-color: #f2f2f2;
          }
        </style>
      </head>
      <body>
          <div class="blog-content-box">
            <div id="article_content" class="article_content clearfix">
              <div id="content_views" class="htmledit_views">
                
                <!-- https://jrs0511.blog.csdn.net/article/details/131031541 -->
<!-- https://jrs0511.blog.csdn.net/article/details/131031541  YOLOv5改进系列（7）——添加SimAM注意力机制_改进yolov5 | 在 c3 模块中添加【simam】-CSDN博客 --> 

                    <p style="text-align:center;"><img alt="" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F3e6cd2c9ce33d9ba0da93118d18fe04d.gif"></p> 
<p style="text-align:center;"><img alt="" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F4e07a8af30c9d1cbf2c83b4b4c24004b.png"></p> 
<p><img alt="962f7cb1b48f44e29d9beb1d499d0530.gif" height="62" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2Fac3c5d6bfbcbf982e8e9e3632d7f20d1.gif" width="62"><strong>【YOLOv5改进系列】前期回顾：</strong>&nbsp;</p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/130564848?spm=1001.2014.3001.5501" title="YOLOv5改进系列（0）——重要性能指标与训练结果评价及分析">YOLOv5改进系列（0）——重要性能指标与训练结果评价及分析</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/130551913?spm=1001.2014.3001.5501" title="YOLOv5改进系列（1）——添加SE注意力机制">YOLOv5改进系列（1）——添加SE注意力机制</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/130587102?spm=1001.2014.3001.5501" title="YOLOv5改进系列（2）——添加CBAM注意力机制">YOLOv5改进系列（2）——添加CBAM注意力机制</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/130619604?spm=1001.2014.3001.5501" title="YOLOv5改进系列（3）——添加CA注意力机制">YOLOv5改进系列（3）——添加CA注意力机制</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/130641318?spm=1001.2014.3001.5501" title="YOLOv5改进系列（4）——添加ECA注意力机制">YOLOv5改进系列（4）——添加ECA注意力机制</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/130832933?spm=1001.2014.3001.5501" title="YOLOv5改进系列（5）——替换主干网络之 MobileNetV3">YOLOv5改进系列（5）——替换主干网络之 MobileNetV3</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/131008642?spm=1001.2014.3001.5501" title="YOLOv5改进系列（6）——替换主干网络之 ShuffleNetV2">YOLOv5改进系列（6）——替换主干网络之 ShuffleNetV2</a></p> 
<p style="text-align:center;">&nbsp;<img alt="" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F3de901aaa0e7f412c1bd582bb2151a03.gif"></p> 
<hr> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%F0%9F%9A%80%E4%B8%80%E3%80%81SimAM%E4%BB%8B%E7%BB%8D-toc" style="margin-left:0px;"><a href="#%F0%9F%9A%80%E4%B8%80%E3%80%81SimAM%E4%BB%8B%E7%BB%8D" rel="nofollow">🚀一、SimAM介绍</a></p> 
<p id="1.1%20%E7%AE%80%E4%BB%8B-toc" style="margin-left:40px;"><a href="#1.1%20%E7%AE%80%E4%BB%8B" rel="nofollow">1.1 简介</a></p> 
<p id="1.2%20%E6%96%B9%E6%B3%95-toc" style="margin-left:40px;"><a href="#1.2%20%E6%96%B9%E6%B3%95" rel="nofollow">1.2 方法</a></p> 
<p id="%F0%9F%9A%80%E4%BA%8C%E3%80%81%E5%9C%A8backbone%E6%9C%AB%E7%AB%AF%E6%B7%BB%E5%8A%A0SimAM%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E6%96%B9%E6%B3%95-toc" style="margin-left:0px;"><a href="#%F0%9F%9A%80%E4%BA%8C%E3%80%81%E5%9C%A8backbone%E6%9C%AB%E7%AB%AF%E6%B7%BB%E5%8A%A0SimAM%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E6%96%B9%E6%B3%95" rel="nofollow">🚀二、在backbone末端添加SimAM注意力机制方法</a></p> 
<p id="2.1%20%E6%B7%BB%E5%8A%A0%E9%A1%BA%E5%BA%8F%C2%A0-toc" style="margin-left:40px;"><a href="#2.1%20%E6%B7%BB%E5%8A%A0%E9%A1%BA%E5%BA%8F%C2%A0" rel="nofollow">2.1 添加顺序&nbsp;</a></p> 
<p id="2.2%20%E5%85%B7%E4%BD%93%E6%B7%BB%E5%8A%A0%E6%AD%A5%E9%AA%A4%C2%A0-toc" style="margin-left:40px;"><a href="#2.2%20%E5%85%B7%E4%BD%93%E6%B7%BB%E5%8A%A0%E6%AD%A5%E9%AA%A4%C2%A0" rel="nofollow">2.2 具体添加步骤&nbsp;</a></p> 
<p id="%E7%AC%AC%E2%91%A0%E6%AD%A5%EF%BC%9A%E5%9C%A8common.py%E4%B8%AD%E6%B7%BB%E5%8A%A0SE%E6%A8%A1%E5%9D%97-toc" style="margin-left:80px;"><a href="#%E7%AC%AC%E2%91%A0%E6%AD%A5%EF%BC%9A%E5%9C%A8common.py%E4%B8%AD%E6%B7%BB%E5%8A%A0SE%E6%A8%A1%E5%9D%97" rel="nofollow">第①步：在common.py中添加SimAM模块</a></p> 
<p id="%C2%A0%E7%AC%AC%E2%91%A1%E6%AD%A5%EF%BC%9A%E5%9C%A8yolo.py%E6%96%87%E4%BB%B6%E9%87%8C%E7%9A%84parse_model%E5%87%BD%E6%95%B0%E5%8A%A0%E5%85%A5%E7%B1%BB%E5%90%8D-toc" style="margin-left:80px;"><a href="#%C2%A0%E7%AC%AC%E2%91%A1%E6%AD%A5%EF%BC%9A%E5%9C%A8yolo.py%E6%96%87%E4%BB%B6%E9%87%8C%E7%9A%84parse_model%E5%87%BD%E6%95%B0%E5%8A%A0%E5%85%A5%E7%B1%BB%E5%90%8D" rel="nofollow">第②步：在yolo.py文件里的parse_model函数加入类名</a></p> 
<p id="%E7%AC%AC%E2%91%A2%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84yaml%E6%96%87%E4%BB%B6%C2%A0-toc" style="margin-left:80px;"><a href="#%E7%AC%AC%E2%91%A2%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84yaml%E6%96%87%E4%BB%B6%C2%A0" rel="nofollow">第③步：创建自定义的yaml文件&nbsp;</a></p> 
<p id="%C2%A0%E7%AC%AC%E2%91%A3%E6%AD%A5%EF%BC%9A%E9%AA%8C%E8%AF%81%E6%98%AF%E5%90%A6%E5%8A%A0%E5%85%A5%E6%88%90%E5%8A%9F-toc" style="margin-left:80px;"><a href="#%C2%A0%E7%AC%AC%E2%91%A3%E6%AD%A5%EF%BC%9A%E9%AA%8C%E8%AF%81%E6%98%AF%E5%90%A6%E5%8A%A0%E5%85%A5%E6%88%90%E5%8A%9F" rel="nofollow">第④步：验证是否加入成功</a></p> 
<p id="%E7%AC%AC%E2%91%A4%E6%AD%A5%EF%BC%9A%E4%BF%AE%E6%94%B9train.py%E4%B8%AD%C2%A0%E2%80%98--cfg%E2%80%99%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0-toc" style="margin-left:80px;"><a href="#%E7%AC%AC%E2%91%A4%E6%AD%A5%EF%BC%9A%E4%BF%AE%E6%94%B9train.py%E4%B8%AD%C2%A0%E2%80%98--cfg%E2%80%99%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0" rel="nofollow">第⑤步：修改train.py中&nbsp;‘--cfg’默认参数</a></p> 
<p id="%F0%9F%9A%80%E4%B8%89%E3%80%81%E5%9C%A8C3%E5%90%8E%E6%B7%BB%E5%8A%A0SimAM%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E6%96%B9%E6%B3%95-toc" style="margin-left:0px;"><a href="#%F0%9F%9A%80%E4%B8%89%E3%80%81%E5%9C%A8C3%E5%90%8E%E6%B7%BB%E5%8A%A0SimAM%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E6%96%B9%E6%B3%95" rel="nofollow">🚀三、在C3后添加SimAM注意力机制方法</a></p> 
<p id="%E7%AC%AC%E2%91%A2%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84yaml%E6%96%87%E4%BB%B6%C2%A0-toc" style="margin-left:80px;"><a href="#%E7%AC%AC%E2%91%A2%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84yaml%E6%96%87%E4%BB%B6%C2%A0" rel="nofollow">第③步：创建自定义的yaml文件&nbsp;</a></p> 
<p id="%E7%AC%AC%E2%91%A3%E6%AD%A5%EF%BC%9A%E9%AA%8C%E8%AF%81%E6%98%AF%E5%90%A6%E5%8A%A0%E5%85%A5%E6%88%90%E5%8A%9F-toc" style="margin-left:80px;"><a href="#%E7%AC%AC%E2%91%A3%E6%AD%A5%EF%BC%9A%E9%AA%8C%E8%AF%81%E6%98%AF%E5%90%A6%E5%8A%A0%E5%85%A5%E6%88%90%E5%8A%9F" rel="nofollow">第④步：验证是否加入成功</a></p> 
<p id="%F0%9F%8C%9F%E6%9C%AC%E4%BA%BAYOLOv5%E7%B3%BB%E5%88%97%E5%AF%BC%E8%88%AA-toc" style="margin-left:0px;"><a href="#%F0%9F%8C%9F%E6%9C%AC%E4%BA%BAYOLOv5%E7%B3%BB%E5%88%97%E5%AF%BC%E8%88%AA" rel="nofollow">🌟本人YOLOv5系列导航</a></p> 
<p id="%F0%9F%8C%9F%E6%9C%AC%E4%BA%BAYOLOv5%E7%B3%BB%E5%88%97%E5%AF%BC%E8%88%AA-toc" style="margin-left:0px;"></p> 
<p style="text-align:center;"><img alt="" height="67" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2Fb315b902be65c3938cc8a94104f3c84e.gif" width="214"></p> 
<h2 id="%F0%9F%9A%80%E4%B8%80%E3%80%81SimAM%E4%BB%8B%E7%BB%8D">🚀一、SimAM介绍</h2> 
<blockquote> 
 <ul><li><strong>论文题目：</strong>《SimAM: A Simple, Parameter-Free Attention&nbsp;<a href="https://so.csdn.net/so/search?q=Module&amp;spm=1001.2101.3001.7020" title="Module">Module</a>&nbsp;for Convolutional Neural Networks》</li><li><strong>论文地址：</strong><a href="http://proceedings.mlr.press/v139/yang21o/yang21o.pdf" rel="nofollow" title="http://proceedings.mlr.press/v139/yang21o/yang21o.pdf">http://proceedings.mlr.press/v139/yang21o/yang21o.pdf</a></li><li><strong>代码地址：</strong><a href="https://github.com/ZjjConan/SimAM" title="GitHub - ZjjConan/SimAM: The official pytorch implemention of our ICML paper &quot;SimAM: A Simple, Parameter-Free Attention Module for Convolutional Neural Networks&quot;.">GitHub - ZjjConan/SimAM: The official pytorch implemention of our ICML paper "SimAM: A Simple, Parameter-Free Attention Module for Convolutional Neural Networks".</a></li></ul> 
</blockquote> 
<h3 id="1.1%20%E7%AE%80%E4%BB%8B">1.1 简介</h3> 
<p><span style="color:#fe2c24;"><strong>SimAM (Simple Attention Mechanism) </strong></span>是中山大学在注意力机制方面的尝试，从神经科学理论出发，构建了一种能量函数挖掘神经元重要性，并对此推导出了解析解以加速计算。通过ImageNet分类、COCO检测与分割等任务验证了所提SimAM的灵活性与有效性。值得一提的是，所提SimAM是一种<span style="color:#fe2c24;">无参数注意力模块</span>。</p> 
<p><span style="color:#fe2c24;"><strong>SimAM</strong></span>的设计思路源于SENet，但不同于SENet的复杂结构，<span style="color:#fe2c24;">SimAM只使用了一个全局池化层和几个全连接层。</span>具体来说，我们在YOLOV5的倒数第二个卷积层后面加上一个全局池化层，将卷积层的输出向量变为标量。然后，我们将这个标量输入到两个全连接层中，以得到两个权重向量。这两个权重向量分别用于加权卷积层的特征图和辅助分类器的特征图。</p> 
<hr> 
<h3 id="1.2%20%E6%96%B9%E6%B3%95">1.2 方法</h3> 
<p><strong><span style="background-color:#38d8f0;">之前的方法&nbsp;</span></strong></p> 
<ol><li><strong>（a）通道注意力：</strong><span style="color:#fe2c24;">1D注意力</span>，它对<span style="color:#511b78;">不同通道</span>区别对待，对所有<span style="color:#ad720d;">位置</span>同等对待；</li><li><strong>（b）空间注意力：</strong><span style="color:#fe2c24;">2D注意力</span>，它对<span style="color:#ad720d;">不同位置</span>区别对待，对所有<span style="color:#511b78;">通道</span>同等对待。</li></ol> 
<p><strong><span style="background-color:#a2e043;">本文的方法</span></strong></p> 
<p><span style="color:#fe2c24;"><strong>权值生成方法</strong></span>。现有注意力往往采用额外的子网络生成注意力权值，比如SE的GAP+FC+ReLU+FC+Sigmoid。更多注意力模块的操作、参数量可参考下表。总而言之，现有注意力的结构设计需要大量的工程性实验。我们认为：<strong>注意力机制的实现应当通过神经科学中的某些统一原则引导设计。</strong></p> 
<hr> 
<h2 id="%F0%9F%9A%80%E4%BA%8C%E3%80%81%E5%9C%A8backbone%E6%9C%AB%E7%AB%AF%E6%B7%BB%E5%8A%A0SimAM%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E6%96%B9%E6%B3%95">🚀二、在backbone末端添加SimAM注意力机制方法</h2> 
<h3 id="2.1%20%E6%B7%BB%E5%8A%A0%E9%A1%BA%E5%BA%8F%C2%A0">2.1 添加顺序&nbsp;</h3> 
<p><span style="color:#fe2c24;"><strong>（1）models/common.py &nbsp; &nbsp;--&gt; </strong></span>&nbsp;加入新增的网络结构</p> 
<p><span style="color:#fe2c24;"><strong>（2） &nbsp; &nbsp; models/yolo.py &nbsp; &nbsp; &nbsp; --&gt; </strong></span>&nbsp;设定网络结构的传参细节，将<strong>SimAM</strong>类名加入其中。（当新的自定义模块中存在输入输出维度时，要使用qw调整输出维度）<br><span style="color:#fe2c24;"><strong>（3） models/yolov5*.yaml &nbsp;--&gt; &nbsp;</strong></span>新建一个文件夹，如<strong>yolov5s_SimAM.yaml</strong>，修改现有模型结构配置文件。（当引入新的层时，要修改后续的结构中的from参数）<br><span style="color:#fe2c24;"><strong>（4） &nbsp; &nbsp; &nbsp; &nbsp; train.py &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;--&gt; </strong></span>&nbsp;修改‘--cfg’默认参数，训练时指定模型结构配置文件&nbsp;</p> 
<hr> 
<h3 id="2.2%20%E5%85%B7%E4%BD%93%E6%B7%BB%E5%8A%A0%E6%AD%A5%E9%AA%A4%C2%A0">2.2 具体添加步骤&nbsp;</h3> 
<h4 id="%E7%AC%AC%E2%91%A0%E6%AD%A5%EF%BC%9A%E5%9C%A8common.py%E4%B8%AD%E6%B7%BB%E5%8A%A0SE%E6%A8%A1%E5%9D%97"><a name="t8"></a><a name="t9"></a><a name="t7"></a><strong><span style="background-color:#38d8f0;">第①步：在common.py中添加SimAM</span></strong><strong><span style="background-color:#38d8f0;">模块</span></strong></h4> 
<p>将下面的<span style="color:#fe2c24;"><strong>SimAM</strong></span>代码复制粘贴到<span style="color:#ad720d;"><strong>common.py</strong></span>文件的末尾</p> 
<pre><code class="language-python">#SimAM
class SimAM(torch.nn.Module):
    def __init__(self, channels=None, out_channels=None, e_lambda=1e-4):
        super(SimAM, self).__init__()

        self.activaton = nn.Sigmoid()
        self.e_lambda = e_lambda

    def __repr__(self):
        s = self.__class__.__name__ + '('
        s += ('lambda=%f)' % self.e_lambda)
        return s

    @staticmethod
    def get_module_name():
        return "simam"

    def forward(self, x):
        b, c, h, w = x.size()

        n = w * h - 1

        x_minus_mu_square = (x - x.mean(dim=[2, 3], keepdim=True)).pow(2)
        y = x_minus_mu_square / (4 * (x_minus_mu_square.sum(dim=[2, 3], keepdim=True) / n + self.e_lambda)) + 0.5

        return x * self.activaton(y)</code></pre> 
<p>如下图所示：</p> 
<p class="img-center"><img alt="" height="344" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F148f605e6adb0641447513c5bf5da164.png" width="577"></p> 
<hr> 
<h4 id="%C2%A0%E7%AC%AC%E2%91%A1%E6%AD%A5%EF%BC%9A%E5%9C%A8yolo.py%E6%96%87%E4%BB%B6%E9%87%8C%E7%9A%84parse_model%E5%87%BD%E6%95%B0%E5%8A%A0%E5%85%A5%E7%B1%BB%E5%90%8D"><span style="background-color:#a2e043;">&nbsp;</span><strong><span style="background-color:#a2e043;">第②步：在yolo.py文件里的parse_model函数加入类名</span></strong></h4> 
<p>首先找到<span style="color:#4da8ee;"><strong>yolo.py</strong></span>里面<span style="color:#1c7331;"><strong>parse_model</strong></span>函数的这一行</p> 
<p class="img-center"><img alt="" height="269" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2Fbba4391d0c7a836a6dd99b450002d847.png" width="559"></p> 
<p>然后把刚才加入的类<span style="color:#fe2c24;"><strong>SimAM</strong></span>添加到这个注册表里面：</p> 
<p class="img-center"><img alt="" height="102" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F805d1bf7c09ca1d106a839a9a6203ae9.png" width="593"></p> 
<hr> 
<h4 id="%E7%AC%AC%E2%91%A2%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84yaml%E6%96%87%E4%BB%B6%C2%A0"><strong><span style="background-color:#ffd900;">第③步：创建自定义的yaml文件</span></strong><span style="background-color:#ffd900;">&nbsp;</span></h4> 
<p>首先在<span style="color:#511b78;"><strong>models</strong></span>文件夹下复制<span style="color:#1c7331;"><strong>yolov5s.yaml&nbsp;</strong></span>文件，粘贴并重命名为&nbsp;<span style="color:#fe2c24;"><strong>yolov5s_SimAM.yaml</strong>&nbsp;</span></p> 
<p class="img-center"><img alt="" height="180" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F0caa9153595ca68ad12ad4d26e5b628f.png" width="569"></p> 
<p>&nbsp;接着修改 &nbsp;<span style="color:#fe2c24;"><strong>yolov5s_SimAM.yaml</strong>&nbsp;</span>&nbsp;，将<span style="color:#fe2c24;"><strong>SimAM模块</strong></span>加到我们想添加的位置。</p> 
<p>这里我先介绍第一种，第一种是将<span style="color:#fe2c24;"><strong>SimAM模块</strong>放在backbone部分的最末端</span>，<strong>这样可以使注意力机制看到整个backbone部分的特征图，将具有全局视野，类似于一个小transformer结构。</strong></p> 
<p>将<strong><span style="background-color:#fef2f0;">&nbsp;[-1，1，<span style="color:#0d0016;">SimAM</span>，[1024]]</span></strong>添加到 SPPF 的下一层。即下图中所示位置：&nbsp;</p> 
<p class="img-center"><img alt="" height="318" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F706ecd341b443bc9f301c150e1abbe5a.png" width="440"></p> 
<p>同样的下面的<strong>head</strong>也得修改：</p> 
<p class="img-center"><img alt="" height="360" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F78edc7ac33a500e4734c8d4c80ea8610.png" width="455"></p> 
<p>&nbsp;这里我们要把后面两个<strong>Concat</strong>的from系数分别由<span style="color:#0d0016;"><strong><span style="background-color:#fef2f0;">[ − 1 , 14 ]</span></strong><span style="background-color:#fef2f0;">&nbsp;</span></span>，<strong>&nbsp;<span style="background-color:#fef2f0;">[ − 1 , 10 ]</span></strong>改为<strong><span style="background-color:#fef2f0;">[ − 1 , 15 ]</span></strong>，<strong><span style="background-color:#fef2f0;">[ − 1 , 11 ]</span></strong>。</p> 
<p>然后将<strong>Detect</strong>原始的from系数<strong><span style="background-color:#fef2f0;">[ 17 , 20 , 23 ]</span></strong>要改为<strong><span style="background-color:#fef2f0;">[ 18 , 21 , 24 ]</span>&nbsp;。</strong></p> 
<p class="img-center"><img alt="" height="429" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F0b6c22fa91f4a4c4f0c38314179421c5.png" width="479"></p> 
<p>&nbsp;<span style="color:#fe2c24;"><strong>yolov5s_SimAM.yaml</strong>&nbsp;</span><strong>完整代码：</strong></p> 
<pre><code class="language-python"># YOLOv5 🚀 by YOLOAir, GPL-3.0 license

# Parameters
nc: 80  # number of classes
depth_multiple: 0.33  # model depth multiple
width_multiple: 0.50  # layer channel multiple
anchors:
  - [10,13, 16,30, 33,23]  # P3/8
  - [30,61, 62,45, 59,119]  # P4/16
  - [116,90, 156,198, 373,326]  # P5/32

backbone:
  # [from, number, module, args]
  [[-1, 1, Conv, [64, 6, 2, 2]],  # 0-P1/2
   [-1, 1, Conv, [128, 3, 2]],  # 1-P2/4
   [-1, 3, C3, [128]],
   [-1, 1, Conv, [256, 3, 2]],  # 3-P3/8
   [-1, 6, C3, [256]],
   [-1, 1, Conv, [512, 3, 2]],  # 5-P4/16
   [-1, 9, C3, [512]],
   [-1, 1, Conv, [1024, 3, 2]],  # 7-P5/32
   [-1, 3, C3, [1024]],
   [-1, 1, SPPF, [1024, 5]],  # 9
   [-1, 3, SimAM, [1024]], # 10
  ]

# YOLOv5 v6.0 head
head:
  [[-1, 1, Conv, [512, 1, 1]],
   [-1, 1, nn.Upsample, [None, 2, 'nearest']],
   [[-1, 6], 1, Concat, [1]],  # cat backbone P4
   [-1, 3, C3, [512, False]],  # 14

   [-1, 1, Conv, [256, 1, 1]],
   [-1, 1, nn.Upsample, [None, 2, 'nearest']],
   [[-1, 4], 1, Concat, [1]],  # cat backbone P3
   [-1, 3, C3, [256, False]],  # 18 (P3/8-small)

   [-1, 1, Conv, [256, 3, 2]],
   [[-1, 15], 1, Concat, [1]],  # cat head P4
   [-1, 3, C3, [512, False]],  # 21 (P4/16-medium)

   [-1, 1, Conv, [512, 3, 2]],
   [[-1, 11], 1, Concat, [1]],  # cat head P5
   [-1, 3, C3, [1024, False]],  # 24 (P5/32-large)

   [[18, 21, 24], 1, Detect, [nc, anchors]],  # Detect(P3, P4, P5)
  ]
</code></pre> 
<hr> 
<h4 id="%C2%A0%E7%AC%AC%E2%91%A3%E6%AD%A5%EF%BC%9A%E9%AA%8C%E8%AF%81%E6%98%AF%E5%90%A6%E5%8A%A0%E5%85%A5%E6%88%90%E5%8A%9F"><span style="background-color:#ffd7b9;">第④步：验证是否加入成功</span></h4> 
<p>在<span style="color:#4da8ee;"><strong>yolo.py&nbsp;</strong></span>文件里面配置改为我们刚才自定义的<span style="color:#fe2c24;"><strong>yolov5s_SimAM.yaml</strong></span></p> 
<p class="img-center"><img alt="" height="153" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F2a6c7f38ebad354059dc24c5694fc6a1.png" width="672"></p> 
<p class="img-center"><img alt="" height="189" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F3d791acadafeeb23190d324b7c3032c6.png" width="665"></p> 
<p>&nbsp;然后我们运行<span style="color:#4da8ee;"><strong>yolo.py</strong>&nbsp;</span></p> 
<p><img alt="" height="1090" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F7a179e637005811989d16cc17ab1028b.png" width="1200"></p> 
<p>&nbsp;哇哦~果真是无参数捏！</p> 
<hr> 
<h4 id="%E7%AC%AC%E2%91%A4%E6%AD%A5%EF%BC%9A%E4%BF%AE%E6%94%B9train.py%E4%B8%AD%C2%A0%E2%80%98--cfg%E2%80%99%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0"><strong><span style="background-color:#9c8ec1;">第⑤步：修改train.py中&nbsp;‘--cfg’默认参数</span></strong></h4> 
<p>我们先找到<strong>&nbsp;<span style="color:#1a439c;">train.py</span>&nbsp;</strong>文件的<span style="color:#1c7331;"><strong>parse_opt</strong></span>函数，然后将第二行<strong><span style="background-color:#fef2f0;">‘--cfg’</span></strong>的&nbsp;<strong>default</strong>改为<span style="color:#fe2c24;"><strong>yolov5s_SimAM.yaml</strong></span>，然后就可以开始训练啦~</p> 
<p><img alt="" height="243" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F62864aab442d783d3bff0b55cb72e8de.png" width="1200"></p> 
<hr> 
<h2 id="%F0%9F%9A%80%E4%B8%89%E3%80%81%E5%9C%A8C3%E5%90%8E%E6%B7%BB%E5%8A%A0SimAM%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E6%96%B9%E6%B3%95">🚀三、在C3后添加SimAM注意力机制方法</h2> 
<p>第二种是将<strong><span style="color:#fe2c24;">SimAM</span></strong><span style="color:#fe2c24;">放在backbone部分每个C3模块的后面</span>，<strong>这样可以使注意力机制看到局部的特征，每层进行一次注意力，可以分担学习压力。</strong></p> 
<p>步骤和方法1相同，只是yaml文件不同。</p> 
<p>所以接下来只放修改yaml文件的部分~</p> 
<hr> 
<h4><strong><span style="background-color:#ffd900;">第③步：创建自定义的yaml文件</span></strong><span style="background-color:#ffd900;">&nbsp;</span></h4> 
<p>将<span style="color:#fe2c24;"><strong>SimAM模块</strong></span><span style="color:#0d0016;">放在每个C3模块的后面，要注意通道的变化。</span></p> 
<p><span style="color:#0d0016;">如下图所示：</span></p> 
<p class="img-center"><img alt="" height="443" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F2d7d22dd94f744bd75569b78f1fcbe82.png" width="382"></p> 
<p>同样的，下面的head部分也要做相应的修改</p> 
<p>（数的时候一定要认真，我今天上午弄错了，卡了半天55~）&nbsp;</p> 
<p class="img-center"><img alt="" height="358" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F7c1876ebfd53e54fce5fb6d6cd689aeb.png" width="430"></p> 
<p><strong>第二种方法的</strong>&nbsp;<span style="color:#fe2c24;"><strong>yolov5s_SimAM.yaml</strong>&nbsp;</span><strong>完整代码：</strong></p> 
<pre><code class="language-python"># YOLOv5 🚀 by Ultralytics, GPL-3.0 license

# Parameters
nc: 80  # number of classes
depth_multiple: 0.33  # model depth multiple
width_multiple: 0.50  # layer channel multiple
anchors:
  - [10,13, 16,30, 33,23]  # P3/8
  - [30,61, 62,45, 59,119]  # P4/16
  - [116,90, 156,198, 373,326]  # P5/32

# YOLOv5 v6.0 backbone
backbone:
  # [from, number, module, args]
  [[-1, 1, Conv, [64, 6, 2, 2]],  # 0-P1/2
   [-1, 1, Conv, [128, 3, 2]],  # 1-P2/4
   [-1, 3, C3, [128]],
   [-1, 3, SimAM, [128]],
   [-1, 1, Conv, [256, 3, 2]],  # 4-P3/8
   [-1, 6, C3, [256]],
   [-1, 3, SimAM, [256]],
   [-1, 1, Conv, [512, 3, 2]],  # 7-P4/16
   [-1, 9, C3, [512]],
   [-1, 3, SimAM, [512]],
   [-1, 1, Conv, [1024, 3, 2]],  # 10-P5/32
   [-1, 3, C3, [1024]],
   [-1, 3, SimAM, [1024]],
   [-1, 1, SPPF, [1024, 5]],  # 13

  ]

# YOLOv5 v6.0 head
head:
  [[-1, 1, Conv, [512, 1, 1]],
   [-1, 1, nn.Upsample, [None, 2, 'nearest']],
   [[-1, 9], 1, Concat, [1]],  # cat backbone P4
   [-1, 3, C3, [512, False]],  # 17

   [-1, 1, Conv, [256, 1, 1]],
   [-1, 1, nn.Upsample, [None, 2, 'nearest']],
   [[-1, 6], 1, Concat, [1]],  # cat backbone P3
   [-1, 3, C3, [256, False]],  # 21 (P3/8-small)

   [-1, 1, Conv, [256, 3, 2]],
   [[-1, 18], 1, Concat, [1]],  # cat head P4
   [-1, 3, C3, [512, False]],  # 24 (P4/16-medium)

   [-1, 1, Conv, [512, 3, 2]],
   [[-1, 14], 1, Concat, [1]],  # cat head P5
   [-1, 3, C3, [1024, False]],  # 27 (P5/32-large)

   [[21, 24, 27], 1, Detect, [nc, anchors]],  # Detect(P3, P4, P5)
  ]</code></pre> 
<hr> 
<h4 id="%E7%AC%AC%E2%91%A3%E6%AD%A5%EF%BC%9A%E9%AA%8C%E8%AF%81%E6%98%AF%E5%90%A6%E5%8A%A0%E5%85%A5%E6%88%90%E5%8A%9F"><span style="background-color:#ffd7b9;">第④步：验证是否加入成功</span></h4> 
<p>同样的方法，我们来运行一下<span style="color:#4da8ee;"><strong>yolo.py&nbsp;</strong></span></p> 
<p class="img-center"><img alt="" height="481" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F36575254a8510ccb58b1b555c996a271.png" width="556"></p> 
<p>OK~完成啦！</p> 
<hr> 
<p><strong>&nbsp;PS：</strong>今天尝试加入SimAM注意力机制训练时间为4个多小时（比昨天轻量化网络还快？）；结果比之前尝试效果最佳的CA注意力机制还涨了近1个点，可以说非常奈斯了！</p> 
<hr> 
<h2 id="%F0%9F%8C%9F%E6%9C%AC%E4%BA%BAYOLOv5%E7%B3%BB%E5%88%97%E5%AF%BC%E8%88%AA">🌟本人YOLOv5系列导航</h2> 
<p><img alt="962f7cb1b48f44e29d9beb1d499d0530.gif" height="69" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2Fac3c5d6bfbcbf982e8e9e3632d7f20d1.gif" width="69">​&nbsp; &nbsp;🍀<strong><strong><strong><strong><a href="https://so.csdn.net/so/search?q=YOLOv5%E6%BA%90%E7%A0%81&amp;spm=1001.2101.3001.7020" title="YOLOv5源码">YOLOv5源码</a></strong></strong></strong>详解系列：</strong>&nbsp;&nbsp;</p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/129356033?spm=1001.2014.3001.5501" title="YOLOv5源码逐行超详细注释与解读（1）——项目目录结构解析">YOLOv5源码逐行超详细注释与解读（1）——项目目录结构解析</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/129349094?spm=1001.2014.3001.5501" title="​​​​​​YOLOv5源码逐行超详细注释与解读（2）——推理部分detect.py">​​​​​​YOLOv5源码逐行超详细注释与解读（2）——推理部分detect.py</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/129460666?spm=1001.2014.3001.5501" title="YOLOv5源码逐行超详细注释与解读（3）——训练部分train.py">YOLOv5源码逐行超详细注释与解读（3）——训练部分train.py</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/129649553?spm=1001.2014.3001.5501" title="YOLOv5源码逐行超详细注释与解读（4）——验证部分val（test）.py">YOLOv5源码逐行超详细注释与解读（4）——验证部分val（test）.py</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/129697521?spm=1001.2014.3001.5501" title="YOLOv5源码逐行超详细注释与解读（5）——配置文件yolov5s.yaml">YOLOv5源码逐行超详细注释与解读（5）——配置文件yolov5s.yaml</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/129803802?spm=1001.2014.3001.5501" title="YOLOv5源码逐行超详细注释与解读（6）——网络结构（1）yolo.py">YOLOv5源码逐行超详细注释与解读（6）——网络结构（1）yolo.py</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/129854764?spm=1001.2014.3001.5501" title="YOLOv5源码逐行超详细注释与解读（7）——网络结构（2）common.py">YOLOv5源码逐行超详细注释与解读（7）——网络结构（2）common.py</a></p> 
<p><img alt="962f7cb1b48f44e29d9beb1d499d0530.gif" height="69" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2Fac3c5d6bfbcbf982e8e9e3632d7f20d1.gif" width="69">​​&nbsp; &nbsp;🍀<strong><strong><strong><strong><strong><strong><strong><strong><a href="https://so.csdn.net/so/search?q=YOLOv5%E6%BA%90%E7%A0%81&amp;spm=1001.2101.3001.7020" title="YOLOv5入门实践">YOLOv5入门实践</a></strong></strong></strong></strong></strong></strong></strong>系列：</strong>&nbsp;&nbsp;</p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/129981848?spm=1001.2014.3001.5501" title="YOLOv5入门实践（1）——手把手带你环境配置搭建">YOLOv5入门实践（1）——手把手带你环境配置搭建</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/129995604?spm=1001.2014.3001.5501" title="YOLOv5入门实践（2）——手把手教你利用labelimg标注数据集">YOLOv5入门实践（2）——手把手教你利用labelimg标注数据集</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/130025866?spm=1001.2014.3001.5501" title="YOLOv5入门实践（3）——手把手教你划分自己的数据集">YOLOv5入门实践（3）——手把手教你划分自己的数据集</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/130043351?spm=1001.2014.3001.5501" title="YOLOv5入门实践（4）——手把手教你训练自己的数据集">YOLOv5入门实践（4）——手把手教你训练自己的数据集</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/130044342?spm=1001.2014.3001.5501" title="YOLOv5入门实践（5）——从零开始，手把手教你训练自己的目标检测模型（包含pyqt5界面）">YOLOv5入门实践（5）——从零开始，手把手教你训练自己的目标检测模型（包含pyqt5界面）</a></p> 
<p style="text-align:center;"><img alt="" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2Ff6ba02be26b6085f4e7ba1d4b96caa76.gif"></p>
                
              </div>
              </div>
          </div>
      </body>
      </html>