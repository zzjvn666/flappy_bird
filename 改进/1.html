<!DOCTYPE html>
      <html lang="zh-CN">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link rel="stylesheet" type="text/css" href="https://csdnimg.cn/release/blogv2/dist/pc/css/detail_enter-2fe393ff58.min.css">
        <link rel="stylesheet" type="text/css" href="https://csdnimg.cn/public/sandalstrap/1.4/css/sandalstrap.min.css">
        <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/kdoc_html_views-1a98987dfd.css">
        <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/ck_htmledit_views-704d5b9767.css">
        <style>
          body {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
          }
          img {
            max-width: 100%;
            height: auto;
          }
          pre {
            background-color: #e4dfdf;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
          }
          code {
            font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
          }
          blockquote {
            background: #f9f9f9;
            border-left: 10px solid #ccc;
            margin: 1.5em 10px;
            padding: 0.5em 10px;
          }
          table {
            border-collapse: collapse;
            width: 100%;
          }
          th, td {
            border: 1px solid #ddd;
            padding: 8px;
          }
          th {
            background-color: #f2f2f2;
          }
        </style>
      </head>
      <body>
          <div class="blog-content-box">
            <div id="article_content" class="article_content clearfix">
              <div id="content_views" class="htmledit_views">
                
                <!-- https://jrs0511.blog.csdn.net/article/details/130551913 -->
<!-- https://jrs0511.blog.csdn.net/article/details/130551913  YOLOv5改进系列（1）——添加SE注意力机制_yolov5添加se注意力机制-CSDN博客 --> 

                    <h4 id="%F0%9F%8C%9F%E6%9C%AC%E4%BA%BAYOLOv5%E7%B3%BB%E5%88%97%E5%AF%BC%E8%88%AA"><img alt="" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2Fbf035c39f3c8e0106fc155987655ce7d.gif"></h4> 
<p style="text-align:center;"><img alt="" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2Fae4cbc129cc5941e7a856acef80ae26a.png"></p> 
<h2 id="%E5%89%8D%E8%A8%80%C2%A0">前言&nbsp;</h2> 
<p>从这篇开始我们进入YOLOv5改进系列。那就先从最简单的添加注意力机制开始吧！（￣︶￣）↗</p> 
<p><img alt="962f7cb1b48f44e29d9beb1d499d0530.gif" height="62" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2Fac3c5d6bfbcbf982e8e9e3632d7f20d1.gif" width="62"><strong>【YOLOv5改进系列】前期回顾：</strong></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/130564848?spm=1001.2014.3001.5501" title="YOLOv5改进系列（0）——重要性能指标与训练结果评价及分析">YOLOv5改进系列（0）——重要性能指标与训练结果评价及分析</a></p> 
<p class="img-center"><img alt="" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F0840d762e04505379c5e8af78ae73bce.gif"></p> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%E5%89%8D%E8%A8%80%C2%A0-toc" style="margin-left:0px;"><a href="#%E5%89%8D%E8%A8%80%C2%A0" rel="nofollow">前言&nbsp;</a></p> 
<p id="%F0%9F%9A%80%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%EF%BC%9F-toc" style="margin-left:0px;"><a href="#%F0%9F%9A%80%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%EF%BC%9F" rel="nofollow">🚀一、什么是注意力机制？</a></p> 
<p id="%F0%9F%9A%80%E4%BA%8C%E3%80%81SE%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E5%8E%9F%E7%90%86-toc" style="margin-left:0px;"><a href="#%F0%9F%9A%80%E4%BA%8C%E3%80%81SE%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E5%8E%9F%E7%90%86" rel="nofollow">🚀二、SE注意力机制原理</a></p> 
<p id="2.1%20%E6%96%B9%E6%B3%95%E4%BB%8B%E7%BB%8D-toc" style="margin-left:40px;"><a href="#2.1%20%E6%96%B9%E6%B3%95%E4%BB%8B%E7%BB%8D" rel="nofollow">2.1 方法介绍</a></p> 
<p id="2.2%20%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84-toc" style="margin-left:40px;"><a href="#2.2%20%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84" rel="nofollow">2.2 网络结构</a></p> 
<p id="%F0%9F%9A%80%20%E4%B8%89%E3%80%81%E6%B7%BB%E5%8A%A0SE%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E6%96%B9%E6%B3%95-toc" style="margin-left:0px;"><a href="#%F0%9F%9A%80%20%E4%B8%89%E3%80%81%E6%B7%BB%E5%8A%A0SE%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E6%96%B9%E6%B3%95" rel="nofollow">🚀 三、添加SE注意力机制方法</a></p> 
<p id="3.1%20%E6%B7%BB%E5%8A%A0%E9%A1%BA%E5%BA%8F-toc" style="margin-left:40px;"><a href="#3.1%20%E6%B7%BB%E5%8A%A0%E9%A1%BA%E5%BA%8F" rel="nofollow">3.1 添加顺序</a></p> 
<p id="%C2%A03.2%20%E5%85%B7%E4%BD%93%E6%B7%BB%E5%8A%A0%E6%AD%A5%E9%AA%A4-toc" style="margin-left:40px;"><a href="#%C2%A03.2%20%E5%85%B7%E4%BD%93%E6%B7%BB%E5%8A%A0%E6%AD%A5%E9%AA%A4" rel="nofollow">&nbsp;3.2 具体添加步骤</a></p> 
<p id="%E7%AC%AC%E2%91%A0%E6%AD%A5%EF%BC%9A%E5%9C%A8common.py%E4%B8%AD%E6%B7%BB%E5%8A%A0SE%E6%A8%A1%E5%9D%97-toc" style="margin-left:80px;"><a href="#%E7%AC%AC%E2%91%A0%E6%AD%A5%EF%BC%9A%E5%9C%A8common.py%E4%B8%AD%E6%B7%BB%E5%8A%A0SE%E6%A8%A1%E5%9D%97" rel="nofollow">第①步：在common.py中添加SE模块</a></p> 
<p id="%E7%AC%AC%E2%91%A1%E6%AD%A5%EF%BC%9A%E5%9C%A8yolo.py%E6%96%87%E4%BB%B6%E9%87%8C%E7%9A%84parse_model%E5%87%BD%E6%95%B0%E5%8A%A0%E5%85%A5%E7%B1%BB%E5%90%8D-toc" style="margin-left:80px;"><a href="#%E7%AC%AC%E2%91%A1%E6%AD%A5%EF%BC%9A%E5%9C%A8yolo.py%E6%96%87%E4%BB%B6%E9%87%8C%E7%9A%84parse_model%E5%87%BD%E6%95%B0%E5%8A%A0%E5%85%A5%E7%B1%BB%E5%90%8D" rel="nofollow">第②步：在yolo.py文件里的parse_model函数加入类名</a></p> 
<p id="%E7%AC%AC%E2%91%A2%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84yaml%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#%E7%AC%AC%E2%91%A2%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84yaml%E6%96%87%E4%BB%B6" rel="nofollow">第③步：创建自定义的yaml文件</a></p> 
<p id="%E7%AC%AC%E2%91%A3%E6%AD%A5%EF%BC%9A%E9%AA%8C%E8%AF%81%E6%98%AF%E5%90%A6%E5%8A%A0%E5%85%A5%E6%88%90%E5%8A%9F-toc" style="margin-left:80px;"><a href="#%E7%AC%AC%E2%91%A3%E6%AD%A5%EF%BC%9A%E9%AA%8C%E8%AF%81%E6%98%AF%E5%90%A6%E5%8A%A0%E5%85%A5%E6%88%90%E5%8A%9F" rel="nofollow">第④步：验证是否加入成功</a></p> 
<p id="%E7%AC%AC%E2%91%A4%E6%AD%A5%EF%BC%9A%E4%BF%AE%E6%94%B9train.py%E4%B8%AD%C2%A0%E2%80%98--cfg%E2%80%99%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0-toc" style="margin-left:80px;"><a href="#%E7%AC%AC%E2%91%A4%E6%AD%A5%EF%BC%9A%E4%BF%AE%E6%94%B9train.py%E4%B8%AD%C2%A0%E2%80%98--cfg%E2%80%99%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0" rel="nofollow">第⑤步：修改train.py中&nbsp;‘--cfg’默认参数</a></p> 
<p id="%F0%9F%8C%9F%E6%9C%AC%E4%BA%BAYOLOv5%E7%B3%BB%E5%88%97%E5%AF%BC%E8%88%AA-toc" style="margin-left:0px;"><a href="#%F0%9F%8C%9F%E6%9C%AC%E4%BA%BAYOLOv5%E7%B3%BB%E5%88%97%E5%AF%BC%E8%88%AA" rel="nofollow">🌟本人YOLOv5系列导航</a></p> 
<p></p> 
<h2 id="%E2%80%8B%E7%BC%96%E8%BE%91%C2%A0" style="text-align:center;"><img alt="" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2Fda2587af76ecaf2dadac06716e705d40.gif"></h2> 
<h2 id="%F0%9F%9A%80%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%EF%BC%9F">🚀一、什么是注意力机制？</h2> 
<p>我们先来看一张图片，这个是前段时间微博之夜的</p> 
<p><img alt="" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F409c952dd379b62019bbfaf81b2d742b.gif"></p> 
<p>那大家的目光更多停留在是在五个美女身上，还是在张大大身上呢 ？（大大老师骚瑞~ORZ）</p> 
<p>同样的，不同的粉丝更加关注的对象也是不同的。&nbsp;</p> 
<p>再举几个栗子：</p> 
<p>看人--&gt;看脸<br> 看文章--&gt;看标题<br> 看段落--&gt;看开头<br> 这时候大家应该大致知道注意力机制是个什么东西了吧~</p> 
<p><strong><span style="background-color:#38d8f0;">原理</span></strong></p> 
<p><strong>注意力机制</strong>其实是源自于人对于外部信息的处理能力。由于人每一时刻接受的信息都是无比的庞大且复杂，远远超过人脑的处理能力，因此人在处理信息的时候，<span style="color:#fe2c24;">会将注意力放在需要关注的信息上，对于其他无关的外部信息进行过滤</span>，这种处理方式被称为注意力机制。</p> 
<p>我用通俗的大白话解释一下：注意力呢，对于我们人来说可以理解为<span style="color:#fe2c24;">“关注度”</span>，对于没有感情的机器来说其实就是<span style="color:#fe2c24;">赋予多少权重(比如0-1之间的小数)</span>，<span style="color:#fe2c24;">越重要的地方或者越相关的地方就赋予越高的权重。</span></p> 
<p><strong><span style="color:#0d0016;"><span style="background-color:#ffd900;">作用</span></span></strong></p> 
<ul><li><strong>1.提高模型的准确性: </strong>注意力机制可以帮助模型更好地关注重要的信息，从而提高模型的准确性。</li><li><strong>2.模型解释性更强: </strong>注意力机制可以让模型更好地解释其决策过程，从而提高模型的可解释性。</li><li><strong>3.可以处理不定长的序列数据: </strong>注意力机制可以处理不定长的序列数据，比如文本数据、语音数据等。</li></ul> 
<p><strong><span style="background-color:#a2e043;">不足</span></strong></p> 
<ul><li><strong>1.计算量大:</strong>注意力机制需要计算每个位置的权重，因此计算量较大，训练时间较长。</li><li><strong>2.可能出现过拟合: </strong>如果注意力机制的权重过于复杂，可能会导致过拟合的问题。</li><li><strong>3.可能需要更多的数据: </strong>注意力机制需要更多的数据来训练和优化，否则可能会出现欠拟合的问题。</li></ul> 
<blockquote> 
 <p>更多关于注意力机制的讲解，欢迎大家看我的这篇文章（自认为写的还行）：<a href="https://blog.csdn.net/weixin_43334693/article/details/130189238?spm=1001.2014.3001.5501" title="【Transformer系列（2）】注意力机制、自注意力机制、多头注意力机制、通道注意力机制、空间注意力机制超详细讲解">【Transformer系列（2）】注意力机制、自注意力机制、多头注意力机制、通道注意力机制、空间注意力机制超详细讲解</a></p> 
</blockquote> 
<hr> 
<h2 id="%F0%9F%9A%80%E4%BA%8C%E3%80%81SE%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E5%8E%9F%E7%90%86">🚀二、SE注意力机制原理</h2> 
<blockquote> 
 <p>本人的SE论文精读：<a href="https://blog.csdn.net/weixin_43334693/article/details/128563228" title="经典神经网络论文超详细解读（七）——SENet（注意力机制）学习笔记（翻译＋精读＋代码复现）">经典神经网络论文超详细解读（七）——SENet（注意力机制）学习笔记（翻译＋精读＋代码复现）</a></p> 
 <p>本人的SE代码复现：<a href="https://blog.csdn.net/weixin_43334693/article/details/128567913" title="SENet代码复现＋超详细注释（PyTorch）">SENet代码复现＋超详细注释（PyTorch）</a></p> 
</blockquote> 
<hr> 
<h3 id="2.1%20%E6%96%B9%E6%B3%95%E4%BB%8B%E7%BB%8D">2.1 方法介绍</h3> 
<p><span style="color:#fe2c24;"><strong>SE注意力机制（Squeeze-and-Excitation Networks）</strong></span>在通道维度增加注意力机制，关键操作是<span style="color:#6eaad7;"><strong>squeeze</strong></span>和<strong><span style="color:#1c7331;">excitation</span></strong>。</p> 
<p>通过自动学习的方式，使用另外一个新的神经网络，获取到特征图的每个通道的重要程度，然后用这个重要程度去给每个特征赋予一个权重值，从而让神经网络重点关注某些特征通道。<span style="color:#fe2c24;">提升对当前任务有用的特征图的通道，并抑制对当前任务用处不大的特征通道。</span></p> 
<p>如下图所示，在输入SE注意力机制之前，特征图的每个通道的重要程度都是一样的，通过SENet之后，不同颜色代表不同的权重，使每个特征通道的重要性变得不一样了，使神经网络重点关注某些权重值大的通道。</p> 
<p><img alt="" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F077c90022ed4f69f67c6786e91606eac.jpeg">​</p> 
<h3 id="2.2%20%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84">2.2 网络结构</h3> 
<p><img alt="" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F195aa4adb91ab1e188ca667c67321e99.png">​&nbsp;</p> 
<p><span style="color:#4da8ee;"><strong>1.Ftr—传统卷积操作：</strong></span>对于一个C×W×H的输入X，在经过Ftr卷积操作之后，得到的输出Uc​（也就是C个大小为H×W的特征图）</p> 
<div> 
 <p class="img-center"><img alt="" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F07f594de7503f96569ac686622305d31.png"></p> 
</div> 
<p><strong><span style="color:#ff9900;">2.Fsq—压缩：</span></strong>Fsq操作就是使用通道的<strong>全局平均池化</strong>，<strong>将包含全局信息的<span style="color:#fe2c24;">W×H×C</span>的特征图直接压缩成一个<span style="color:#fe2c24;">1×1×C</span>的特征向量，</strong>即将每个二维通道变成一个具有全局感受野的数值，此时1个像素表示1个通道，屏蔽掉空间上的分布信息，更好的利用通道间的相关性。</p> 
<div> 
 <p class="img-center"><img alt="" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F97caf9a9b930d71d88aef28b95ddc39c.png"></p> 
 <p>​</p> 
</div> 
<p><span style="color:#1c7331;"><strong>3.Fex—激励：</strong></span><strong>采用<span style="color:#fe2c24;">两个全连接层+两个激活函数</span>组成的结构输出和输入特征同样数目的权重值，</strong>也就是每个特征通道的权重系数。</p> 
<p>&nbsp;<strong> (1)第一个FC层：</strong>ReLU （δ）</p> 
<p><strong>&nbsp; (2)第二个FC层：</strong>Sigmoid（σ）</p> 
<p><img alt="" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F76f52c0ebfe0cdcf7092fe6b1e1fd29f.png">​&nbsp;</p> 
<p><strong><span style="color:#956fe7;">4.Fscale​ —权重：</span></strong>将Excitation输出的权重看做每个特征通道的重要性，也就是<strong>对于U每个位置上的所有H×W上的值都乘上对应通道的权值</strong>，完成对原始特征的重校准。</p> 
<hr> 
<h2 id="%F0%9F%9A%80%20%E4%B8%89%E3%80%81%E6%B7%BB%E5%8A%A0SE%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E6%96%B9%E6%B3%95">🚀 三、添加SE注意力机制方法</h2> 
<p>在介绍方法前我们先来回顾一下YOLOv5内一会儿要修改的文件：</p> 
<p><strong><span style="color:#4da8ee;">models/common.py：</span></strong>这个文件存放着YOLOv5网络搭建常见的通用模块。<strong>如果我们需要修改某一模块，那么就需要修改这个文件中对应模块的定义。</strong></p> 
<p><span style="color:#e6b223;"><strong>models/yolo.py：</strong></span>这是<a href="https://so.csdn.net/so/search?q=YOLO&amp;spm=1001.2101.3001.7020" title="YOLO">YOLO</a>的特定模块，和网络构建有关。这个文件主要由三个部分：<strong>parse_model函数、Detect类和Model类</strong>组成。其中parse_model方法是对网络结构进行整体搭建，同时起到注册common.py中各类模块的作用。<br><span style="color:#1c7331;"><strong>models/yolov5s.yaml(以s结构为例)：</strong></span>网络的配置文件，<span style="color:#e6b223;"><strong>models/yolo.py</strong></span>依据这个配置文件中的信息对整体网络进行构建。<a href="https://so.csdn.net/so/search?q=YOLOv5s&amp;spm=1001.2101.3001.7020" title="YOLOv5s">YOLOv5s</a>网络是YOLOv5系列中深度最小，特征图的宽度最小的网络。其他的三种都是在此基础上不断加深，不断加宽。</p> 
<hr> 
<h3 id="3.1%20%E6%B7%BB%E5%8A%A0%E9%A1%BA%E5%BA%8F">3.1 添加顺序</h3> 
<p><strong><span style="color:#fe2c24;">（1）models/common.py&nbsp; &nbsp; --&gt;&nbsp;&nbsp;</span></strong>加入新增的网络结构</p> 
<p><span style="color:#fe2c24;"><strong>（2）&nbsp; &nbsp; &nbsp;models/yolo.py&nbsp; &nbsp; &nbsp; &nbsp;--&gt;&nbsp;&nbsp;</strong></span><span style="color:#0d0016;">设定网络结构的传参细节，将SE类名加入其中。（当新的自定义模块中存在输入输出维度时，要使用qw调整输出维度）</span><br><strong><span style="color:#fe2c24;">（3） models/yolov5*.yaml</span></strong><span style="color:#fe2c24;"><strong>&nbsp; --&gt;&nbsp;</strong>&nbsp;</span><span style="color:#0d0016;">新建一个文件夹，如yolov5s_SE.yaml，修改现有模型结构配置文件。（当引入新的层时，要修改后续的结构中的from参数）</span><br><span style="color:#fe2c24;"><strong>（4）&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;train.py&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp;--&gt;&nbsp;</strong></span><span style="color:#0d0016;"> 修改‘--cfg’默认参数，训练时指定模型结构配置文件</span></p> 
<hr> 
<h3 id="%C2%A03.2%20%E5%85%B7%E4%BD%93%E6%B7%BB%E5%8A%A0%E6%AD%A5%E9%AA%A4">&nbsp;3.2 具体添加步骤</h3> 
<h4 id="%E7%AC%AC%E2%91%A0%E6%AD%A5%EF%BC%9A%E5%9C%A8common.py%E4%B8%AD%E6%B7%BB%E5%8A%A0SE%E6%A8%A1%E5%9D%97"><strong><span style="background-color:#38d8f0;">第①步：在common.py中添加SE模块</span></strong></h4> 
<p>将下面的<span style="color:#fe2c24;"><strong>SE</strong></span>代码复制粘贴到<span style="color:#4da8ee;"><strong>common.py</strong></span>文件的末尾</p> 
<pre><code class="language-python">class SE(nn.Module):
    def __init__(self, c1, c2, r=16):
        super(SE, self).__init__()
        self.avgpool = nn.AdaptiveAvgPool2d(1)
        self.l1 = nn.Linear(c1, c1 // r, bias=False)
        self.relu = nn.ReLU(inplace=True)
        self.l2 = nn.Linear(c1 // r, c1, bias=False)
        self.sig = nn.Sigmoid()
    def forward(self, x):
        print(x.size())
        b, c, _, _ = x.size()
        y = self.avgpool(x).view(b, c)
        y = self.l1(y)
        y = self.relu(y)
        y = self.l2(y)
        y = self.sig(y)
        y = y.view(b, c, 1, 1)
        return x * y.expand_as(x)</code></pre> 
<p>如下图所示：</p> 
<p><img alt="" height="1021" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2Fad6fa91d28d4e69ed0e8df59f36a5f93.png" width="1200"></p> 
<hr> 
<h4 id="%E7%AC%AC%E2%91%A1%E6%AD%A5%EF%BC%9A%E5%9C%A8yolo.py%E6%96%87%E4%BB%B6%E9%87%8C%E7%9A%84parse_model%E5%87%BD%E6%95%B0%E5%8A%A0%E5%85%A5%E7%B1%BB%E5%90%8D"><strong><span style="background-color:#a2e043;">第②步：在yolo.py文件里的parse_model函数加入类名</span></strong></h4> 
<p>首先找到<span style="color:#ad720d;"><strong>yolo.py</strong></span>里面<span style="color:#956fe7;"><strong>parse_model</strong></span>函数的这一行</p> 
<p><img alt="" height="722" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2Fbba4391d0c7a836a6dd99b450002d847.png" width="1200"></p> 
<p>&nbsp;然后把<span style="color:#fe2c24;"><strong>SE</strong></span>添加到这个注册表里面</p> 
<p><img alt="" height="734" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2Fac7c2e14e771bf91e2b0f149154a23bd.png" width="1200"></p> 
<hr> 
<h4 id="%E7%AC%AC%E2%91%A2%E6%AD%A5%EF%BC%9A%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84yaml%E6%96%87%E4%BB%B6"><strong><span style="background-color:#ffd900;">第③步：创建自定义的yaml文件</span></strong></h4> 
<p>首先在<span style="color:#956fe7;"><strong>models</strong></span>文件夹下复制<span style="color:#1c7331;"><strong>yolov5s.yaml </strong></span>文件，粘贴并重命名为&nbsp;<span style="color:#fe2c24;"><strong>yolov5s_SE.yaml</strong>&nbsp;</span></p> 
<p><img alt="" height="304" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2Fa98234e951b7082c7fe68b7a47cd9d1b.png" width="963"></p> 
<p>接着修改<span style="color:#fe2c24;"> <strong>yolov5s_SE.yaml</strong>&nbsp;</span>，将 SE加到我们想添加的位置。</p> 
<p>注意力机制可以添加在backbone，Neck，Head等部分， 常见的有两种：<strong>一是在主干的 SPPF 前添加一层；</strong><strong>二是将backbone中的C3全部替换</strong>。不同的位置效果可能不同，需要我们用数据集反复测试，“调参大师”就是这样诞生的~</p> 
<p>在这里我是用第一种：将<strong><span style="color:#fe2c24;"> [-1，1，SE，[1024]]</span></strong>添加到 SPPF 的上一层，即下图中所示位置：</p> 
<p><img alt="" height="512" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F2de2587e48e59fb26a1e835e7480a9e3.png" width="629"></p> 
<blockquote> 
 <p>这里回顾一下<strong>[from, number, module, args]</strong>四个参数含义：</p> 
 <ul><li><strong><span style="background-color:#fef2f0;">from ： </span></strong>&nbsp; 表示当前模块的输入来自那一层的输出，-1表示将上一层的输出当做自己的输入（第0层的-1表示输入的图像）。</li><li><strong><span style="background-color:#fef2f0;">number：</span> &nbsp;</strong>表示当前模块的重复次数，实际的重复次数还要由上面的参数depth_multiple共同决定，决定网络模型的深度。</li><li><strong><span style="background-color:#fef2f0;">module：</span> &nbsp;</strong>表示该层模块的名称，这些模块写在common.py中，进行模块化的搭建网络。</li><li><strong><span style="background-color:#fef2f0;">args：</span></strong> &nbsp;表示类的初始化参数，用于解析作为 moudle 的传入参数，会在网络搭建过程中根据不同层进行改变。</li></ul> 
</blockquote> 
<p>这时要注意一个问题：</p> 
<p>当在网络中添加了新的层之后，那么该层网络后续的层的编号都会发生改变，原本<strong>Detect</strong>指定的是<strong><span style="color:#0d0016;"><span style="background-color:#fef2f0;">[ 17 , 20 , 23 ]</span></span></strong>层，所以在我们添加了<strong><span style="color:#fe2c24;">SE</span></strong>注意力层之后也要<strong>Detect</strong>对这里进行修改，即原来的17层变成了18 层；原来的20层变成了21 层；原来的23层变成了24 层；所以<strong>Detecet</strong>的from系数要改为<strong><span style="background-color:#fef2f0;">[ 18 , 21 , 24 ] 。</span></strong>如下图所示：</p> 
<p class="img-center"><img alt="" height="430" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F9ce59f13d369eb8719b4eb3059f4c21d.png" width="518"></p> 
<p>&nbsp;修改后：</p> 
<p class="img-center"><img alt="" height="451" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F8a252c8f8bce50e56f7dbfa967e128fb.png" width="534"></p> 
<p></p> 
<p>同样的，<strong>Concat</strong>的from系数也要修改，这样才能保持原网络结构不发生特别大的改变，我们刚才把<span style="color:#fe2c24;"><strong>SE</strong></span>层加到了第9层，所以第9层之后的编号都会加1，这里我们要把后面两个Concat的from系数分别由<strong><span style="background-color:#fef2f0;">[ − 1 , 14 ]</span></strong> ,<strong><span style="background-color:#fef2f0;"> [ − 1 , 10 ]</span></strong>改为<strong><span style="background-color:#fef2f0;">[ − 1 , 15 ] </span></strong>, <strong><span style="background-color:#fef2f0;">[ − 1 , 11 ]</span></strong>。如下图所示：</p> 
<p class="img-center"><img alt="" height="411" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F53f87017f180b0babf3a1b5d6a2eaa8f.png" width="507"></p> 
<p>&nbsp;修改后：</p> 
<p class="img-center"><img alt="" height="428" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F34ed928b9f74c154b424b245a906eb6e.png" width="514"></p> 
<hr> 
<h4 id="%E7%AC%AC%E2%91%A3%E6%AD%A5%EF%BC%9A%E9%AA%8C%E8%AF%81%E6%98%AF%E5%90%A6%E5%8A%A0%E5%85%A5%E6%88%90%E5%8A%9F"><strong><span style="background-color:#dad5e9;">第④步：验证是否加入成功</span></strong></h4> 
<p>在<span style="color:#ad720d;"><strong>yolo.py </strong></span>文件里面配置改为我们刚才自定义的<span style="color:#fe2c24;"><strong>yolov5s_SE.yaml</strong></span></p> 
<p><img alt="" height="349" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F89817e54881de79f02ac8a4108c1be5a.png" width="1200"></p> 
<p><img alt="" height="354" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F649db64e6c3b94e1b501f39bcadd322e.png" width="1200"></p> 
<p>&nbsp;然后运行<span style="color:#ad720d;"><strong>yolo.py </strong></span></p> 
<p><img alt="" height="1155" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F5774c1468f8eb0cb639efad5ec6c37c3.png" width="1200"></p> 
<p>&nbsp;找到<span style="color:#fe2c24;"><strong>SE</strong></span>模块，就说明我们添加成功啦！</p> 
<hr> 
<h4 id="%E7%AC%AC%E2%91%A4%E6%AD%A5%EF%BC%9A%E4%BF%AE%E6%94%B9train.py%E4%B8%AD%C2%A0%E2%80%98--cfg%E2%80%99%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0"><span style="color:#0d0016;"><strong><span style="background-color:#ffd7b9;">第⑤步：修改train.py中&nbsp;‘--cfg’默认参数</span></strong></span></h4> 
<p>我们先找到<span style="color:#511b78;"><strong> train.py </strong></span>文件的<strong><span style="color:#1c7892;">parse_opt</span></strong>函数，然后将第二行<strong><span style="background-color:#fef2f0;">‘--cfg’</span></strong>的&nbsp;<strong><span style="background-color:#fef2f0;">default</span></strong>改为<span style="color:#fe2c24;"><strong>'models/yolov5s_SE.yaml'</strong></span><span style="color:#0d0016;">，然后就可以开始训练啦~</span></p> 
<p><img alt="" height="351" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F5e9caee6977b1b1436340a3dc9fad40c.png" width="1200"></p> 
<hr> 
<p>完结~撒花✿✿ヽ(°▽°)ノ✿</p> 
<hr> 
<h2>🌟本人YOLOv5系列导航</h2> 
<p><img alt="962f7cb1b48f44e29d9beb1d499d0530.gif" height="69" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2Fac3c5d6bfbcbf982e8e9e3632d7f20d1.gif" width="69">​&nbsp; &nbsp;🍀<strong><strong><strong><strong><a href="https://so.csdn.net/so/search?q=YOLOv5%E6%BA%90%E7%A0%81&amp;spm=1001.2101.3001.7020" title="YOLOv5源码">YOLOv5源码</a></strong></strong></strong>详解系列：</strong>&nbsp;&nbsp;</p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/129356033?spm=1001.2014.3001.5501" title="YOLOv5源码逐行超详细注释与解读（1）——项目目录结构解析">YOLOv5源码逐行超详细注释与解读（1）——项目目录结构解析</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/129349094?spm=1001.2014.3001.5501" title="​​​​​​YOLOv5源码逐行超详细注释与解读（2）——推理部分detect.py">​​​​​​YOLOv5源码逐行超详细注释与解读（2）——推理部分detect.py</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/129460666?spm=1001.2014.3001.5501" title="YOLOv5源码逐行超详细注释与解读（3）——训练部分train.py">YOLOv5源码逐行超详细注释与解读（3）——训练部分train.py</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/129649553?spm=1001.2014.3001.5501" title="YOLOv5源码逐行超详细注释与解读（4）——验证部分val（test）.py">YOLOv5源码逐行超详细注释与解读（4）——验证部分val（test）.py</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/129697521?spm=1001.2014.3001.5501" title="YOLOv5源码逐行超详细注释与解读（5）——配置文件yolov5s.yaml">YOLOv5源码逐行超详细注释与解读（5）——配置文件yolov5s.yaml</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/129803802?spm=1001.2014.3001.5501" title="YOLOv5源码逐行超详细注释与解读（6）——网络结构（1）yolo.py">YOLOv5源码逐行超详细注释与解读（6）——网络结构（1）yolo.py</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/129854764?spm=1001.2014.3001.5501" title="YOLOv5源码逐行超详细注释与解读（7）——网络结构（2）common.py">YOLOv5源码逐行超详细注释与解读（7）——网络结构（2）common.py</a></p> 
<p><img alt="962f7cb1b48f44e29d9beb1d499d0530.gif" height="69" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2Fac3c5d6bfbcbf982e8e9e3632d7f20d1.gif" width="69">​&nbsp; &nbsp;🍀<strong><strong><strong><strong><strong><strong><strong><strong><a href="https://so.csdn.net/so/search?q=YOLOv5%E6%BA%90%E7%A0%81&amp;spm=1001.2101.3001.7020" title="YOLOv5入门实践">YOLOv5入门实践</a></strong></strong></strong></strong></strong></strong></strong>系列：</strong>&nbsp;&nbsp;</p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/129981848?spm=1001.2014.3001.5501" title="YOLOv5入门实践（1）——手把手带你环境配置搭建">YOLOv5入门实践（1）——手把手带你环境配置搭建</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/129995604?spm=1001.2014.3001.5501" title="YOLOv5入门实践（2）——手把手教你利用labelimg标注数据集">YOLOv5入门实践（2）——手把手教你利用labelimg标注数据集</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/130025866?spm=1001.2014.3001.5501" title="YOLOv5入门实践（3）——手把手教你划分自己的数据集">YOLOv5入门实践（3）——手把手教你划分自己的数据集</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/130043351?spm=1001.2014.3001.5501" title="YOLOv5入门实践（4）——手把手教你训练自己的数据集">YOLOv5入门实践（4）——手把手教你训练自己的数据集</a></p> 
<p><a href="https://blog.csdn.net/weixin_43334693/article/details/130044342?spm=1001.2014.3001.5501" title="YOLOv5入门实践（5）——从零开始，手把手教你训练自己的目标检测模型（包含pyqt5界面）">YOLOv5入门实践（5）——从零开始，手把手教你训练自己的目标检测模型（包含pyqt5界面）</a></p> 
<blockquote> 
 <p>本文参考（感谢大佬们）：</p> 
 <p>CSDN：<a href="https://blog.csdn.net/weixin_43694096/article/details/124443059?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168343384216800225517372%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=168343384216800225517372&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-124443059-null-null.142%5Ev86%5Ekoosearch_v1,239%5Ev2%5Einsert_chatgpt&amp;utm_term=yolov5%E6%B7%BB%E5%8A%A0%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6&amp;spm=1018.2226.3001.4187" title="手把手带你YOLOv5/v7 添加注意力机制（并附上30多种顶会Attention原理图）2023/2/11更新迪菲赫尔曼的博客-CSDN博客">手把手带你YOLOv5/v7 添加注意力机制（并附上30多种顶会Attention原理图）2023/2/11更新迪菲赫尔曼的博客-CSDN博客</a></p> 
 <p>b站：<a class="link-info" href="?vd_source=725f2b2a52500df1eaed63206ebe0ab2" rel="nofollow">【YOLOv5 v6.1添加SE,CA,CBAM,ECA注意力机制教学，即插即用】</a></p> 
</blockquote> 
<p style="text-align:center;"><img alt="" src="http://apic.todo6.com/app/operate/csdn/proxy?url=https%3A%2F%2Fi-blog.csdnimg.cn%2Fblog_migrate%2F1de39b5b180674ddeb03997ed76cb5c8.gif"></p>
                
              </div>
              </div>
          </div>
      </body>
      </html>